webpackJsonp([16],{50:function(t,e,a){"use strict";function n(t){i||a(593)}Object.defineProperty(e,"__esModule",{value:!0});var o=a(561),r=a(594),i=!1,l=a(1),d=n,c=l(o.a,r.a,!1,d,"data-v-40741708",null);c.options.__file="src\\views\\page\\home.vue",e.default=c.exports},561:function(t,e,a){"use strict";function n(t){if(-1==v)return void alert("当前数据还未加载完毕，请稍等片刻！");var e=g;h.$ajax({method:"post",url:h.$uri+"mapInterface/getTongjiByCoordinate",data:t}).then(function(t){for(var a=(t.data.total,"<div style='width:45%;float:left;margin-left:20px;font-family: Arial,Helvetica,'Microsoft YaHei',sans-serif;'></br><b>该地区共享单车总数为：</b>"+t.data.total+"</br></div>"),n={width:450,height:100},o=0;o<t.data.rows.length;o++){var r=t.data.rows[o];a+="<div style='width:45%;float:left;margin-left:20px;font-family: Arial,Helvetica,'Microsoft YaHei',sans-serif;'></br><b>"+r.companyName+"：</b>"+r.total+"</br></div>",n.height+=30}var i=new BMap.InfoWindow(a,n);m.openInfoWindow(i,new BMap.Point(e[0],e[1]))}).catch(function(t){console.log(t)})}function o(t){w.setDrawingMode(BMAP_DRAWING_RECTANGLE),w.open(),m.centerAndZoom(t,20)}function r(t){w.setDrawingMode(BMAP_DRAWING_POLYGON),w.open(),m.centerAndZoom(t,20)}function i(){var t=y.pop();m.removeOverlay(t)}function l(){window.history.go(-1)}function d(){if(null!=m){for(var t=0;t<y.length;t++)m.removeOverlay(y[t]);y.length=0,M="",A=[]}}function c(t){for(var e=t.areacCoordinate.split("&"),a=[],n=0;n<e.length;n++)!function(t){e[t].split(";").map(function(e){"object"!=u(a[t])&&(a[t]=[]),a[t].push([parseFloat(e.split(",")[0]),parseFloat(e.split(",")[1])])})}(n);return a}function s(t,e){var a,n,o,r,i=0,l=e.length;for(o=e[0],a=1;a<=l;a++)r=e[a%l],t[0]>Math.min(o[0],r[0])&&t[0]<=Math.max(o[0],r[0])&&t[1]<=Math.max(o[1],r[1])&&o[0]!=r[0]&&(n=(t[0]-o[0])*(r[1]-o[1])/(r[0]-o[0])+o[1],(o[1]==r[1]||t[1]<=n)&&i++),o=r;return i%2!=0}function f(t){"6941139967a311e8a93e1843420641b8"!=t&&(t="");var e=new URLSearchParams;e.append("parentId",t),h.$ajax({method:"post",url:h.$uri+"mapInterface/getAreaDataInfo",data:e}).then(function(t){b=[];var e=t.data.rows;e.length>0&&d();for(var a=0;a<e.length;a++){var n=e[a],o=n.areacCoordinate;b.push({id:n.id,areacCoordinate:o}),p(o,n.id)}}).catch(function(t){console.log(t)})}function p(t,e){for(var a=t.split("&"),n=0;n<a.length;n++){var o=a[n],r={strokeWeight:2,strokeColor:"#ff0000"},i=new BMap.Polygon(o,r);A.push({id:e,model:i}),i.addEventListener("click",function(t){if(-1==v)return void alert("当前数据还未加载完毕，请稍等片刻！");var e="";if(m.getZoom()>12){for(var a=0;a<A.length;a++){var n=A[a];t.currentTarget===n.model&&(e=n.id,n.model)}if(""!=e){var o=new URLSearchParams;o.append("id",e);var r=g;h.$ajax({method:"post",url:h.$uri+"mapInterface/getTongji",data:o}).then(function(t){for(var e=(t.data.total,"<div style='width:45%;float:left;margin-left:20px;font-family: Arial,Helvetica,'Microsoft YaHei',sans-serif;'></br><b>该地区共享单车总数为：</b>"+t.data.total+"</br></div>"),a={width:450,height:100},n=0;n<t.data.rows.length;n++){var o=t.data.rows[n];e+="<div style='width:45%;float:left;margin-left:20px;font-family: Arial,Helvetica,'Microsoft YaHei',sans-serif;'></br><b>"+o.companyName+"：</b>"+o.total+"</br></div>",a.height+=30}var i=new BMap.InfoWindow(e,a);m.openInfoWindow(i,new BMap.Point(r[0],r[1]))}).catch(function(t){console.log(t)})}}}),y.push(i),m.addOverlay(i),_=i}}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h=null,v=-1,g="",m=null,w=null,M="",y=[],b=[],I=function(t){var e=w.getDrawingMode();if(e!=BMAP_DRAWING_POLYGON&&e!=BMAP_DRAWING_RECTANGLE){var a=new BMap.ContextMenu;a.addItem(new BMap.MenuItem("返回",function(){d(),m.removeContextMenu(a),l()},{width:140,id:"addarearect"})),a.addItem(new BMap.MenuItem("添加矩形区域",function(){o(t.point),m.removeContextMenu(a)},{width:140,id:"addarearect"})),a.addItem(new BMap.MenuItem("添加不规则区域",function(){r(t.point),m.removeContextMenu(a)},{width:140,id:"addareapolygon"})),a.addItem(new BMap.MenuItem("清除新加区域",function(){i(),m.removeContextMenu(a)},{width:140,id:"cleararea"})),a.addItem(new BMap.MenuItem("附近投放区",function(){t.point,m.removeContextMenu(a)},{width:140,id:"putin"})),a.addItem(new BMap.MenuItem("附近禁投区",function(){t.point,m.removeContextMenu(a)},{width:140,id:"exputin"})),m.addContextMenu(a)}},A=[],_=null;e.a={props:{id:"",areacoords:""},methods:{save:function(){var t=this,e=M,a=this.$route.query.id,n=new URLSearchParams;n.append("areaCoordinate",e),n.append("id",a),this.$ajax({method:"post",url:this.$uri+"mapInterface/updateAreaCoordinate",data:n}).then(function(e){d(),t.$router.push("/richangjianguan/area")}).catch(function(e){console.log(e),d(),t.$router.push("/richangjianguan/area")})},goback:function(){d(),this.$router.go(-1)},clearall:function(){d()}},mounted:function(){h=this,m=new BMap.Map("markmap"),m.centerAndZoom(new BMap.Point(104.072051,30.662979),12),m.enableScrollWheelZoom(!0),m.setMapStyle({style:"grassgreen"});var t={strokeWeight:2,strokeColor:"#ff0000"};w=new BMapLib.DrawingManager(m,{isOpen:!1,enableDrawingTool:!0,enableCalculate:!1,drawingType:BMAP_DRAWING_RECTANGLE,drawingToolOptions:{anchor:BMAP_ANCHOR_TOP_RIGHT,offset:new BMap.Size(5,5),scale:.6,drawingModes:[BMAP_DRAWING_POLYGON,BMAP_DRAWING_RECTANGLE]},circleOptions:t,polylineOptions:t,polygonOptions:t,rectangleOptions:t}),w.addEventListener("overlaycomplete",function(t){y.push(t.overlay),w.close(),w.setDrawingMode(0)}),w.addEventListener("polygoncomplete",function(t){var e=t.getPath(),a="";if(M){for(var o=0;o<e.length;o++){var r=e[o].lat,i=e[o].lng;a+=i+","+r,o<e.length-1&&(a+=";")}M=M+"&"+a}else{for(var o=0;o<e.length;o++){var r=e[o].lat,i=e[o].lng;a+=i+","+r,o<e.length-1&&(a+=";")}M=a}var l=new URLSearchParams;l.append("coordinate",M),n(l)}),w.addEventListener("rectanglecomplete",function(t){var e=t.getPath(),a="";if(M){for(var o=0;o<e.length;o++){var r=e[o].lat,i=e[o].lng;a+=i+","+r,o<e.length-1&&(a+=";")}M=M+"&"+a}else{for(var o=0;o<e.length;o++){var r=e[o].lat,i=e[o].lng;a+=i+","+r,o<e.length-1&&(a+=";")}M=a}var l=new URLSearchParams;l.append("coordinate",M),n(l)}),m.addEventListener("click",function(t){var e=[t.point.lng,t.point.lat],a="",n=m.getZoom();t:for(var o=0;o<b.length;o++)for(var r=b[o],i=c(r),l=0;l<i.length;l++){var f=s(e,i[l]);if(f){a=r.id;break t}}if(""!=a)if(n>12);else{var u=new URLSearchParams;u.append("parentId",a),h.$ajax({method:"post",url:h.$uri+"mapInterface/getAreaDataInfo",data:u}).then(function(t){var e=t.data.rows;e.length>0&&d();for(var a=0;a<e.length;a++){var n=e[a],o=n.areacCoordinate;b.push({id:n.id,areacCoordinate:o}),p(o,n.id)}e.length>0&&m.setViewport(_.getPath())}).catch(function(t){console.log(t)})}}),m.addEventListener("rightclick",I),m.addEventListener("mousemove",function(t,e,a,n,o){g=[t.point.lng,t.point.lat]}),m.addEventListener("zoomend",function(t,e){var a=m.getZoom(),n=g,o="";if(a>12)t:for(var r=0;r<b.length;r++)for(var i=b[r],l=c(i),d=0;d<l.length;d++){var p=s(n,l[d]);if(p){o=i.id;break t}}else o="6941139967a311e8a93e1843420641b8";""!=o&&f(o)});f("6941139967a311e8a93e1843420641b8"),this.$ajax({method:"post",url:this.$uri+"mapInterface/getSessionData"}).then(function(t){b=[];var e=t.data.state;0==e?(v=0,alert("数据加载完毕！")):1==e&&(v=0)}).catch(function(t){console.log(t)})}}},593:function(t,e){},594:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",[a("div",{staticStyle:{width:"100%",height:"900px"}},[a("div",{staticStyle:{height:"5%",width:"100%"}},[a("Button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")]),t._v(" "),a("Button",{attrs:{type:"primary"},on:{click:t.goback}},[t._v("返回")]),t._v(" "),a("Button",{attrs:{type:"primary"},on:{click:t.clearall}},[t._v("清除")])],1),t._v(" "),a("div",{staticStyle:{height:"94%","-webkit-transition":"all 0.5s ease-in-out",transition:"all 0.5s ease-in-out"},attrs:{id:"markmap"}})])])],1)},o=[];n._withStripped=!0;var r={render:n,staticRenderFns:o};e.a=r}});